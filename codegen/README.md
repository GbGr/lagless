# @lagless/codegen

ECS –∫–æ–¥ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π NX –∏ CLI –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üéØ **–ï–¥–∏–Ω—ã–π –ø–∞–∫–µ—Ç**: –û–¥–∏–Ω –Ω–∞–±–æ—Ä EJS —à–∞–±–ª–æ–Ω–æ–≤ –¥–ª—è –≤—Å–µ—Ö —Å–ø–æ—Å–æ–±–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- üîß **NX –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**: –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –¥–ª—è NX workspace
- ‚ö° **CLI –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç**: –ù–µ–∑–∞–≤–∏—Å–∏–º—ã–π CLI –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤–Ω–µ NX
- üìù **EJS —à–∞–±–ª–æ–Ω—ã**: –ú–æ—â–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —à–∞–±–ª–æ–Ω–æ–≤ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —É—Å–ª–æ–≤–∏–π –∏ —Ü–∏–∫–ª–æ–≤
- üé® **–ì–∏–±–∫–∏–π projectName**: –ú–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å –≤ –∫–æ–Ω—Ñ–∏–≥–µ –∏–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑ –ø—É—Ç–∏

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
npm install @lagless/codegen
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1. NX Generator

```bash
nx g ./codegen:ecs --configPath=./config/ecs.yaml
```

### 2. CLI

```bash
# –õ–æ–∫–∞–ª—å–Ω–æ
node ./codegen/dist/cli.js -c ./config/ecs.yaml

# –ì–ª–æ–±–∞–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞
npm install -g @lagless/codegen
lagless-codegen -c ./config/ecs.yaml -o ./src/generated
```

### 3. –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ

```typescript
import { parseYamlConfig, generateCode } from './codegen';
import * as fs from 'fs';
import * as path from 'path';

const configContent = fs.readFileSync('./config.yaml', 'utf-8');
const { schema, projectName } = parseYamlConfig(configContent, './config.yaml');

await generateCode({
  schema,
  projectName,
  outputDir: './generated',
  templateDir: './codegen/files',
  fileOperations: {
    readFile: (path) => fs.readFileSync(path, 'utf-8'),
    writeFile: (path, content) => {
      fs.mkdirSync(path.dirname(path), { recursive: true });
      fs.writeFileSync(path, content, 'utf-8');
    },
    joinPath: (...segments) => path.join(...segments),
    exists: (path) => fs.existsSync(path),
    readDir: (path) => fs.readdirSync(path),
    isDirectory: (path) => fs.statSync(path).isDirectory(),
  }
});
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è YAML

### –° —É–∫–∞–∑–∞–Ω–∏–µ–º projectName

```yaml
projectName: MyAwesomeGame

components:
  Position:
    x: f32
    y: f32
    z: f32
  
  Velocity:
    dx: f32
    dy: f32
    dz: f32

  Health:
    current: f32
    maximum: f32

singletons:
  GameState:
    currentLevel: u32
    score: u64
    isPaused: bool

playerResources:
  PlayerStats:
    experience: u64
    level: u32

inputs:
  PlayerInput:
    moveX: f32
    moveY: f32
    jump: bool
    attack: bool

filters:
  MovableEntities:
    include: [Position, Velocity]
  
  LivingEntities:
    include: [Health]
    exclude: []
```

### –ë–µ–∑ projectName (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑ –ø—É—Ç–∏)

```yaml
components:
  Position:
    x: f32
    y: f32
    z: f32
```

–ü—Ä–∏ –ø—É—Ç–∏ `./my-game/config/ecs.yaml` ‚Üí projectName –±—É–¥–µ—Ç `MyGame`

## –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ç–∏–ø—ã

- `f32`, `f64` - —á–∏—Å–ª–∞ —Å –ø–ª–∞–≤–∞—é—â–µ–π —Ç–æ—á–∫–æ–π
- `i8`, `i16`, `i32` - –∑–Ω–∞–∫–æ–≤—ã–µ —Ü–µ–ª—ã–µ —á–∏—Å–ª–∞
- `u8`, `u16`, `u32` - –±–µ–∑–∑–Ω–∞–∫–æ–≤—ã–µ —Ü–µ–ª—ã–µ —á–∏—Å–ª–∞
- `bool` - –±—É–ª–µ–≤–æ –∑–Ω–∞—á–µ–Ω–∏–µ
- –ú–∞—Å—Å–∏–≤—ã: `f32[10]`, `u32[5]` –∏ —Ç.–¥.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–¥–∞

```
code-gen/
‚îú‚îÄ‚îÄ index.ts                    # Barrel file —Å–æ –≤—Å–µ–º–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞–º–∏
‚îú‚îÄ‚îÄ Position.ts                 # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îú‚îÄ‚îÄ Velocity.ts
‚îú‚îÄ‚îÄ Health.ts
‚îú‚îÄ‚îÄ GameState.ts               # –°–∏–Ω–≥–ª—Ç–æ–Ω—ã
‚îú‚îÄ‚îÄ PlayerStats.ts             # Player Resources
‚îú‚îÄ‚îÄ PlayerInput.ts             # –ò–Ω–ø—É—Ç—ã
‚îú‚îÄ‚îÄ MovableEntities.ts         # –§–∏–ª—å—Ç—Ä—ã
‚îú‚îÄ‚îÄ LivingEntities.ts
‚îú‚îÄ‚îÄ MyAwesomeGameInputRegistry.ts  # –†–µ–µ—Å—Ç—Ä –∏–Ω–ø—É—Ç–æ–≤
‚îú‚îÄ‚îÄ ECSCore.ts                 # –û—Å–Ω–æ–≤–Ω–æ–π ECS –∫–ª–∞—Å—Å
‚îî‚îÄ‚îÄ ECSRunner.ts               # Runner –¥–ª—è –∏–≥—Ä–æ–≤–æ–≥–æ —Ü–∏–∫–ª–∞
```

## –û–ø—Ü–∏–∏ CLI

```bash
lagless-codegen [options]

Options:
  -c, --config <path>     Path to YAML configuration file (required)
  -o, --output <path>     Output directory (default: config_dir/../code-gen)
  -t, --templates <path>  Custom templates directory
  -h, --help              Display help
  -V, --version           Display version
```

## –ö–∞—Å—Ç–æ–º–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã

–í—ã –º–æ–∂–µ—Ç–µ —Å–æ–∑–¥–∞—Ç—å —Å–≤–æ–∏ —à–∞–±–ª–æ–Ω—ã, —Å–∫–æ–ø–∏—Ä–æ–≤–∞–≤ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏–∑ `files/`:

```bash
cp -r ./codegen/files ./my-templates
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —à–∞–±–ª–æ–Ω—ã
lagless-codegen -c config.yaml -t ./my-templates
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ —à–∞–±–ª–æ–Ω–∞—Ö

- `name` - –∏–º—è —ç–ª–µ–º–µ–Ω—Ç–∞ (–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞, —Å–∏–Ω–≥–ª—Ç–æ–Ω–∞ –∏ —Ç.–¥.)
- `projectName` - –∏–º—è –ø—Ä–æ–µ–∫—Ç–∞
- `fields` - –ø–æ–ª—è —ç–ª–µ–º–µ–Ω—Ç–∞
- `schema` - –ø–æ–ª–Ω–∞—è —Å—Ö–µ–º–∞
- `typeToArrayConstructor` - –º–∞–ø–ø–∏–Ω–≥ —Ç–∏–ø–æ–≤
- –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
npm install

# –°–±–æ—Ä–∫–∞
npm run build

# –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å watch —Ä–µ–∂–∏–º–æ–º
npm run dev
```
